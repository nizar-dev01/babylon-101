(()=>{"use strict";var e={5505:(e,t,i)=>{var n=i(9963),s=i(6252);function o(e,t){const i=(0,s.up)("router-view");return(0,s.wg)(),(0,s.j4)(i)}var a=i(3744);const r={},l=(0,a.Z)(r,[["render",o]]),h=l;var c=i(2201);const d={ref:"canvas"};function p(e,t,i,n,o,a){return(0,s.wg)(),(0,s.iD)("canvas",d,null,512)}i(9962),i(9520),i(8475);var m=i(5169);class u{inputMap;_scene;horizontal=0;vertical=0;horizontalAxis=0;verticalAxis=0;jumpKeyDown=!1;dashing=!1;_ui;mobileLeft;mobileRight;mobileUp;mobileDown;_mobileJump;_mobileDash;constructor(e,t){this._scene=e,this._ui=t,this._scene.actionManager=new m.ActionManager(this._scene),this.inputMap={},this._scene.actionManager.registerAction(new m.ExecuteCodeAction(m.ActionManager.OnKeyDownTrigger,(e=>{this.inputMap[e.sourceEvent.key]="keydown"==e.sourceEvent.type}))),this._scene.actionManager.registerAction(new m.ExecuteCodeAction(m.ActionManager.OnKeyUpTrigger,(e=>{this.inputMap[e.sourceEvent.key]="keydown"==e.sourceEvent.type}))),e.onBeforeRenderObservable.add((()=>{this._updateFromKeyboard()})),this._ui.isMobile&&this._setUpMobile()}_updateFromKeyboard(){!this.inputMap["ArrowUp"]&&!this.mobileUp||this._ui.gamePaused?!this.inputMap["ArrowDown"]&&!this.mobileDown||this._ui.gamePaused?(this.vertical=0,this.verticalAxis=0):(this.vertical=m.Scalar.Lerp(this.vertical,-1,.2),this.verticalAxis=-1):(this.verticalAxis=1,this.vertical=m.Scalar.Lerp(this.vertical,1,.2)),!this.inputMap["ArrowLeft"]&&!this.mobileLeft||this._ui.gamePaused?!this.inputMap["ArrowRight"]&&!this.mobileRight||this._ui.gamePaused?(this.horizontal=0,this.horizontalAxis=0):(this.horizontal=m.Scalar.Lerp(this.horizontal,1,.2),this.horizontalAxis=1):(this.horizontal=m.Scalar.Lerp(this.horizontal,-1,.2),this.horizontalAxis=-1),!this.inputMap["Shift"]&&!this._mobileDash||this._ui.gamePaused?this.dashing=!1:this.dashing=!0,!this.inputMap[" "]&&!this._mobileJump||this._ui.gamePaused?this.jumpKeyDown=!1:this.jumpKeyDown=!0}_setUpMobile(){this._ui.jumpBtn.onPointerDownObservable.add((()=>{this._mobileJump=!0})),this._ui.jumpBtn.onPointerUpObservable.add((()=>{this._mobileJump=!1})),this._ui.dashBtn.onPointerDownObservable.add((()=>{this._mobileDash=!0})),this._ui.dashBtn.onPointerUpObservable.add((()=>{this._mobileDash=!1})),this._ui.leftBtn.onPointerDownObservable.add((()=>{this.mobileLeft=!0})),this._ui.leftBtn.onPointerUpObservable.add((()=>{this.mobileLeft=!1})),this._ui.rightBtn.onPointerDownObservable.add((()=>{this.mobileRight=!0})),this._ui.rightBtn.onPointerUpObservable.add((()=>{this.mobileRight=!1})),this._ui.upBtn.onPointerDownObservable.add((()=>{this.mobileUp=!0})),this._ui.upBtn.onPointerUpObservable.add((()=>{this.mobileUp=!1})),this._ui.downBtn.onPointerDownObservable.add((()=>{this.mobileDown=!0})),this._ui.downBtn.onPointerUpObservable.add((()=>{this.mobileDown=!1}))}}class _ extends m.TransformNode{camera;scene;_input;mesh;_camRoot;_yTilt;_run;_idle;_jump;_land;_dash;_currentAnim=null;_prevAnim;_isFalling=!1;_jumped=!1;static PLAYER_SPEED=.45;static JUMP_FORCE=.8;static GRAVITY=-2.8;static DASH_FACTOR=2.5;static DASH_TIME=10;static DOWN_TILT=new m.Vector3(.8290313946973066,0,0);static ORIGINAL_TILT=new m.Vector3(.5934119456780721,0,0);dashTime=0;_deltaTime=0;_h;_v;_moveDirection=new m.Vector3;_inputAmt;_dashPressed;_canDash=!0;_gravity=new m.Vector3;_lastGroundPos=m.Vector3.Zero();_grounded;_jumpCount=1;lanternsLit=1;totalLanterns;win=!1;sparkler;sparkLit=!0;sparkReset=!1;_raisePlatform;lightSfx;sparkResetSfx;_resetSfx;_walkingSfx;_jumpingSfx;_dashingSfx;onRun=new m.Observable;tutorial_move;tutorial_dash;tutorial_jump;constructor(e,t,i,n){super("player",t),this.scene=t,this._loadSounds(this.scene),this._setupPlayerCamera(),this.mesh=e.mesh,this.mesh.parent=this,this.scene.getLightByName("sparklight").parent=this.scene.getTransformNodeByName("Empty"),this._idle=e.animationGroups[1],this._jump=e.animationGroups[2],this._land=e.animationGroups[3],this._run=e.animationGroups[4],this._dash=e.animationGroups[0],this.mesh.actionManager=new m.ActionManager(this.scene),this.mesh.actionManager.registerAction(new m.ExecuteCodeAction({trigger:m.ActionManager.OnIntersectionEnterTrigger,parameter:this.scene.getMeshByName("destination")},(()=>{22==this.lanternsLit&&(this.win=!0,this._yTilt.rotation=new m.Vector3(5.689773361501514,.23736477827122882,0),this._yTilt.position=new m.Vector3(0,6,0),this.camera.position.y=17)}))),this.mesh.actionManager.registerAction(new m.ExecuteCodeAction({trigger:m.ActionManager.OnIntersectionEnterTrigger,parameter:this.scene.getMeshByName("ground")},(()=>{this.mesh.position.copyFrom(this._lastGroundPos),this._resetSfx.play()}))),this.onRun.add((e=>{e&&!this._walkingSfx.isPlaying?this._walkingSfx.play():!e&&this._walkingSfx.isPlaying&&(this._walkingSfx.stop(),this._walkingSfx.isPlaying=!1)})),this._createSparkles(),this._setUpAnimations(),i.addShadowCaster(e.mesh),this._input=n}_updateFromControls(){this._deltaTime=this.scene.getEngine().getDeltaTime()/1e3,this._moveDirection=m.Vector3.Zero(),this._h=this._input.horizontal,this._v=this._input.vertical,0==this._h&&0==this._v||this.tutorial_move||(this.tutorial_move=!0),this._input.dashing&&!this._dashPressed&&this._canDash&&!this._grounded&&(this._canDash=!1,this._dashPressed=!0,this._currentAnim=this._dash,this._dashingSfx.play(),this.tutorial_dash||(this.tutorial_dash=!0));let e=1;this._dashPressed&&(this.dashTime>_.DASH_TIME?(this.dashTime=0,this._dashPressed=!1):e=_.DASH_FACTOR,this.dashTime++);let t=this._camRoot.forward,i=this._camRoot.right,n=t.scaleInPlace(this._v),s=i.scaleInPlace(this._h),o=s.addInPlace(n);this._moveDirection=new m.Vector3(o.normalize().x*e,0,o.normalize().z*e);let a=Math.abs(this._h)+Math.abs(this._v);this._inputAmt=a<0?0:a>1?1:a,this._moveDirection=this._moveDirection.scaleInPlace(this._inputAmt*_.PLAYER_SPEED);let r=new m.Vector3(this._input.horizontalAxis,0,this._input.verticalAxis);if(0==r.length())return;let l=Math.atan2(this._input.horizontalAxis,this._input.verticalAxis);l+=this._camRoot.rotation.y;let h=m.Quaternion.FromEulerAngles(0,l,0);this.mesh.rotationQuaternion=m.Quaternion.Slerp(this.mesh.rotationQuaternion,h,10*this._deltaTime)}_setUpAnimations(){this.scene.stopAllAnimations(),this._run.loopAnimation=!0,this._idle.loopAnimation=!0,this._currentAnim=this._idle,this._prevAnim=this._land}_animatePlayer(){this._dashPressed||this._isFalling||this._jumped||!(this._input.inputMap["ArrowUp"]||this._input.mobileUp||this._input.inputMap["ArrowDown"]||this._input.mobileDown||this._input.inputMap["ArrowLeft"]||this._input.mobileLeft||this._input.inputMap["ArrowRight"]||this._input.mobileRight)?!this._jumped||this._isFalling||this._dashPressed?!this._isFalling&&this._grounded?(this._currentAnim=this._idle,this.scene.getSoundByName("walking").isPlaying&&this.onRun.notifyObservers(!1)):this._isFalling&&(this._currentAnim=this._land):this._currentAnim=this._jump:(this._currentAnim=this._run,this.onRun.notifyObservers(!0)),null!=this._currentAnim&&this._prevAnim!==this._currentAnim&&(this._prevAnim.stop(),this._currentAnim.play(this._currentAnim.loopAnimation),this._prevAnim=this._currentAnim)}_floorRaycast(e,t,i){let n=new m.Vector3(this.mesh.position.x+e,this.mesh.position.y+.5,this.mesh.position.z+t),s=new m.Ray(n,m.Vector3.Up().scale(-1),i),o=function(e){return e.isPickable&&e.isEnabled()},a=this.scene.pickWithRay(s,o);return a.hit?a.pickedPoint:m.Vector3.Zero()}_isGrounded(){return!this._floorRaycast(0,0,.6).equals(m.Vector3.Zero())}_checkSlope(){let e=function(e){return e.isPickable&&e.isEnabled()},t=new m.Vector3(this.mesh.position.x,this.mesh.position.y+.5,this.mesh.position.z+.25),i=new m.Ray(t,m.Vector3.Up().scale(-1),1.5),n=this.scene.pickWithRay(i,e),s=new m.Vector3(this.mesh.position.x,this.mesh.position.y+.5,this.mesh.position.z-.25),o=new m.Ray(s,m.Vector3.Up().scale(-1),1.5),a=this.scene.pickWithRay(o,e),r=new m.Vector3(this.mesh.position.x+.25,this.mesh.position.y+.5,this.mesh.position.z),l=new m.Ray(r,m.Vector3.Up().scale(-1),1.5),h=this.scene.pickWithRay(l,e),c=new m.Vector3(this.mesh.position.x-.25,this.mesh.position.y+.5,this.mesh.position.z),d=new m.Ray(c,m.Vector3.Up().scale(-1),1.5),p=this.scene.pickWithRay(d,e);if(n.hit&&!n.getNormal().equals(m.Vector3.Up())){if(n.pickedMesh.name.includes("stair"))return!0}else if(a.hit&&!a.getNormal().equals(m.Vector3.Up())){if(a.pickedMesh.name.includes("stair"))return!0}else if(h.hit&&!h.getNormal().equals(m.Vector3.Up())){if(h.pickedMesh.name.includes("stair"))return!0}else if(p.hit&&!p.getNormal().equals(m.Vector3.Up())&&p.pickedMesh.name.includes("stair"))return!0;return!1}_updateGroundDetection(){this._deltaTime=this.scene.getEngine().getDeltaTime()/1e3,this._isGrounded()||(this._checkSlope()&&this._gravity.y<=0?(console.log("slope"),this._gravity.y=0,this._jumpCount=1,this._grounded=!0):(this._gravity=this._gravity.addInPlace(m.Vector3.Up().scale(this._deltaTime*_.GRAVITY)),this._grounded=!1)),this._gravity.y<-_.JUMP_FORCE&&(this._gravity.y=-_.JUMP_FORCE),this._gravity.y<0&&this._jumped&&(this._isFalling=!0),this.mesh.moveWithCollisions(this._moveDirection.addInPlace(this._gravity)),this._isGrounded()&&(this._gravity.y=0,this._grounded=!0,this._lastGroundPos.copyFrom(this.mesh.position),this._jumpCount=1,this._canDash=!0,this.dashTime=0,this._dashPressed=!1,this._jumped=!1,this._isFalling=!1),this._input.jumpKeyDown&&this._jumpCount>0&&(this._gravity.y=_.JUMP_FORCE,this._jumpCount--,this._jumped=!0,this._isFalling=!1,this._jumpingSfx.play(),this.tutorial_jump||(this.tutorial_jump=!0))}_beforeRenderUpdate(){this._updateFromControls(),this._updateGroundDetection(),this._animatePlayer()}activatePlayerCamera(){return this.scene.registerBeforeRender((()=>{this._beforeRenderUpdate(),this._updateCamera()})),this.camera}_updateCamera(){this.mesh.intersectsMesh(this.scene.getMeshByName("cornerTrigger"))&&(this._input.horizontalAxis>0?this._camRoot.rotation=m.Vector3.Lerp(this._camRoot.rotation,new m.Vector3(this._camRoot.rotation.x,Math.PI/2,this._camRoot.rotation.z),.4):this._input.horizontalAxis<0&&(this._camRoot.rotation=m.Vector3.Lerp(this._camRoot.rotation,new m.Vector3(this._camRoot.rotation.x,Math.PI,this._camRoot.rotation.z),.4))),this.mesh.intersectsMesh(this.scene.getMeshByName("festivalTrigger"))&&(this._input.verticalAxis>0?this._yTilt.rotation=m.Vector3.Lerp(this._yTilt.rotation,_.DOWN_TILT,.4):this._input.verticalAxis<0&&(this._yTilt.rotation=m.Vector3.Lerp(this._yTilt.rotation,_.ORIGINAL_TILT,.4))),this.mesh.intersectsMesh(this.scene.getMeshByName("destinationTrigger"))&&(this._input.verticalAxis>0?this._yTilt.rotation=m.Vector3.Lerp(this._yTilt.rotation,_.ORIGINAL_TILT,.4):this._input.verticalAxis<0&&(this._yTilt.rotation=m.Vector3.Lerp(this._yTilt.rotation,_.DOWN_TILT,.4)));let e=this.mesh.position.y+2;this._camRoot.position=m.Vector3.Lerp(this._camRoot.position,new m.Vector3(this.mesh.position.x,e,this.mesh.position.z),.4)}_setupPlayerCamera(){this._camRoot=new m.TransformNode("root"),this._camRoot.position=new m.Vector3(0,0,0),this._camRoot.rotation=new m.Vector3(0,Math.PI,0);let e=new m.TransformNode("ytilt");return e.rotation=_.ORIGINAL_TILT,this._yTilt=e,e.parent=this._camRoot,this.camera=new m.UniversalCamera("cam",new m.Vector3(0,0,-30),this.scene),this.camera.lockedTarget=this._camRoot.position,this.camera.fov=.47350045992678597,this.camera.parent=e,this.scene.activeCamera=this.camera,this.camera}_createSparkles(){const e=m.Mesh.CreateSphere("sparkles",4,1,this.scene);e.position=new m.Vector3(0,0,0),e.parent=this.scene.getTransformNodeByName("Empty"),e.isVisible=!1;let t=new m.ParticleSystem("sparkles",1e3,this.scene);t.particleTexture=new m.Texture("textures/flwr.png",this.scene),t.emitter=e,t.particleEmitterType=new m.SphereParticleEmitter(0),t.updateSpeed=.014,t.minAngularSpeed=0,t.maxAngularSpeed=360,t.minEmitPower=1,t.maxEmitPower=3,t.minSize=.5,t.maxSize=2,t.minScaleX=.5,t.minScaleY=.5,t.color1=new m.Color4(.8,.8549019607843137,1,1),t.color2=new m.Color4(.8509803921568627,.7647058823529411,1,1),t.addRampGradient(0,m.Color3.White()),t.addRampGradient(1,m.Color3.Black()),t.getRampGradients()[0].color=m.Color3.FromHexString("#BBC1FF"),t.getRampGradients()[1].color=m.Color3.FromHexString("#FFFFFF"),t.maxAngularSpeed=0,t.maxInitialRotation=360,t.minAngularSpeed=-10,t.maxAngularSpeed=10,t.start(),this.sparkler=t}_loadSounds(e){this.lightSfx=new m.Sound("light","./sounds/Rise03.mp3",e,(function(){})),this.sparkResetSfx=new m.Sound("sparkReset","./sounds/Rise04.mp3",e,(function(){})),this._jumpingSfx=new m.Sound("jumping","./sounds/187024__lloydevans09__jump2.wav",e,(function(){}),{volume:.25}),this._dashingSfx=new m.Sound("dashing","./sounds/194081__potentjello__woosh-noise-1.wav",e,(function(){})),this._walkingSfx=new m.Sound("walking","./sounds/Concrete 2.wav",e,(function(){}),{loop:!0,volume:.2,playbackRate:.6}),this._resetSfx=new m.Sound("reset","./sounds/Retro Magic Protection 25.wav",e,(function(){}),{volume:.25})}}var g,w=i(1046);class T{_scene;time;_prevTime=0;_clockTime=null;_startTime;_stopTimer;_sString="00";_mString=11;_lanternCnt;_sparklerLife;_spark;stopSpark;_handle;_sparkhandle;gamePaused;quit;transition=!1;pauseBtn;fadeLevel;_playerUI;_pauseMenu;_controls;tutorial;hint;isMobile;jumpBtn;dashBtn;leftBtn;rightBtn;upBtn;downBtn;quitSfx;_sfx;_pause;_sparkWarningSfx;constructor(e){this._scene=e;const t=w.AdvancedDynamicTexture.CreateFullscreenUI("UI");this._playerUI=t,this._playerUI.idealHeight=720;const i=new w.TextBlock;i.name="lantern count",i.textVerticalAlignment=w.TextBlock.VERTICAL_ALIGNMENT_CENTER,i.horizontalAlignment=w.Control.HORIZONTAL_ALIGNMENT_RIGHT,i.verticalAlignment=w.Control.VERTICAL_ALIGNMENT_TOP,i.fontSize="22px",i.color="white",i.text="Lanterns: 1 / 22",i.top="32px",i.left="-64px",i.width="25%",i.fontFamily="Viga",i.resizeToFit=!0,t.addControl(i),this._lanternCnt=i;const n=new w.StackPanel;n.height="100%",n.width="100%",n.top="14px",n.verticalAlignment=0,t.addControl(n);const s=new w.TextBlock;s.name="clock",s.textHorizontalAlignment=w.TextBlock.HORIZONTAL_ALIGNMENT_CENTER,s.fontSize="48px",s.color="white",s.text="11:00",s.resizeToFit=!0,s.height="96px",s.width="220px",s.fontFamily="Viga",n.addControl(s),this._clockTime=s;const o=new w.Image("sparkLife","./sprites/sparkLife.png");o.width="54px",o.height="162px",o.cellId=0,o.cellHeight=108,o.cellWidth=36,o.sourceWidth=36,o.sourceHeight=108,o.horizontalAlignment=0,o.verticalAlignment=0,o.left="14px",o.top="14px",t.addControl(o),this._sparklerLife=o;const a=new w.Image("spark","./sprites/spark.png");a.width="40px",a.height="40px",a.cellId=0,a.cellHeight=20,a.cellWidth=20,a.sourceWidth=20,a.sourceHeight=20,a.horizontalAlignment=0,a.verticalAlignment=0,a.left="21px",a.top="20px",t.addControl(a),this._spark=a;const r=w.Button.CreateImageOnlyButton("pauseBtn","./sprites/pauseBtn.png");r.width="48px",r.height="86px",r.thickness=0,r.verticalAlignment=0,r.horizontalAlignment=1,r.top="-16px",t.addControl(r),r.zIndex=10,this.pauseBtn=r,r.onPointerDownObservable.add((()=>{this._pauseMenu.isVisible=!0,t.addControl(this._pauseMenu),this.pauseBtn.isHitTestVisible=!1,this.gamePaused=!0,this._prevTime=this.time,this._scene.getSoundByName("gameSong").pause(),this._pause.play()}));const l=new w.Rectangle;l.horizontalAlignment=w.Control.HORIZONTAL_ALIGNMENT_RIGHT,l.verticalAlignment=w.Control.VERTICAL_ALIGNMENT_TOP,l.top="12%",l.left="-1%",l.height=.2,l.width=.2,l.thickness=0,l.alpha=.6,this._playerUI.addControl(l),this.tutorial=l;let h=new w.Image("pause","sprites/tutorial.jpeg");l.addControl(h);const c=new w.Rectangle;c.horizontalAlignment=w.Control.HORIZONTAL_ALIGNMENT_RIGHT,c.verticalAlignment=w.Control.VERTICAL_ALIGNMENT_TOP,c.top="14%",c.left="-4%",c.height=.08,c.width=.08,c.thickness=0,c.alpha=.6,c.isVisible=!1,this._playerUI.addControl(c),this.hint=c;const d=new w.Image("lantern1","sprites/arrowBtn.png");d.rotation=Math.PI/2,d.stretch=w.Image.STRETCH_UNIFORM,d.height=.8,d.verticalAlignment=w.Control.VERTICAL_ALIGNMENT_TOP,c.addControl(d);const p=new w.TextBlock("move","Move Right");if(p.color="white",p.fontSize="12px",p.fontFamily="Viga",p.verticalAlignment=w.Control.VERTICAL_ALIGNMENT_BOTTOM,p.textWrapping=!0,p.resizeToFit=!0,c.addControl(p),this._createPauseMenu(),this._createControlsMenu(),this._loadSounds(e),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){this.isMobile=!0,h.isVisible=!1;let e=new w.Image("pause","sprites/tutorialMobile.jpeg");l.addControl(e);const i=new w.Rectangle;i.horizontalAlignment=w.Control.HORIZONTAL_ALIGNMENT_RIGHT,i.verticalAlignment=w.Control.VERTICAL_ALIGNMENT_BOTTOM,i.height=.4,i.width=.2,i.left="-2%",i.top="-2%",i.thickness=0,t.addControl(i);const n=new w.Grid;n.addColumnDefinition(.5),n.addColumnDefinition(.5),n.addRowDefinition(.5),n.addRowDefinition(.5),i.addControl(n);const s=w.Button.CreateImageOnlyButton("dash","./sprites/aBtn.png");s.thickness=0,s.alpha=.8,s.horizontalAlignment=w.Control.HORIZONTAL_ALIGNMENT_RIGHT,this.dashBtn=s;const o=w.Button.CreateImageOnlyButton("jump","./sprites/bBtn.png");o.thickness=0,o.alpha=.8,o.horizontalAlignment=w.Control.HORIZONTAL_ALIGNMENT_LEFT,this.jumpBtn=o,n.addControl(s,0,1),n.addControl(o,1,0);const a=new w.Rectangle;a.horizontalAlignment=w.Control.HORIZONTAL_ALIGNMENT_LEFT,a.verticalAlignment=w.Control.VERTICAL_ALIGNMENT_BOTTOM,a.height=.4,a.width=.4,a.left="2%",a.top="-2%",a.thickness=0,t.addControl(a);const r=new w.Grid;r.addColumnDefinition(.4),r.addColumnDefinition(.4),r.addColumnDefinition(.4),r.addRowDefinition(.5),r.addRowDefinition(.5),a.addControl(r);const c=w.Button.CreateImageOnlyButton("left","./sprites/arrowBtn.png");c.thickness=0,c.rotation=-Math.PI/2,c.color="white",c.alpha=.8,c.width=.8,c.horizontalAlignment=w.Control.HORIZONTAL_ALIGNMENT_LEFT,this.leftBtn=c;const d=w.Button.CreateImageOnlyButton("right","./sprites/arrowBtn.png");d.rotation=Math.PI/2,d.thickness=0,d.color="white",d.alpha=.8,d.width=.8,d.horizontalAlignment=w.Control.HORIZONTAL_ALIGNMENT_RIGHT,this.rightBtn=d;const p=w.Button.CreateImageOnlyButton("up","./sprites/arrowBtn.png");p.thickness=0,p.alpha=.8,p.color="white",this.upBtn=p;const m=w.Button.CreateImageOnlyButton("down","./sprites/arrowBtn.png");m.thickness=0,m.rotation=Math.PI,m.color="white",m.alpha=.8,this.downBtn=m,r.addControl(c,1,0),r.addControl(d,1,2),r.addControl(p,0,1),r.addControl(m,1,1)}}updateHud(){if(!this._stopTimer&&null!=this._startTime){let e=Math.floor(((new Date).getTime()-this._startTime)/1e3)+this._prevTime;this.time=e,this._clockTime.text=this._formatTime(e)}}updateLanternCount(e){this._lanternCnt.text="Lanterns: "+e+" / 22"}startTimer(){this._startTime=(new Date).getTime(),this._stopTimer=!1}stopTimer(){this._stopTimer=!0}_formatTime(e){let t=Math.floor(e/60),i=e%240;i%4==0&&(this._mString=Math.floor(t/4)+11,this._sString=(i/4<10?"0":"")+i/4);let n=11==this._mString?" PM":" AM";return this._mString+":"+this._sString+n}startSparklerTimer(e){this.stopSpark=!1,this._sparklerLife.cellId=0,this._spark.cellId=0,this._handle&&clearInterval(this._handle),this._sparkhandle&&clearInterval(this._sparkhandle),this._sparkWarningSfx.stop(),null!=e&&(e.start(),this._scene.getLightByName("sparklight").intensity=35),this._handle=setInterval((()=>{this.gamePaused?this._sparkWarningSfx.pause():(this._sparklerLife.cellId<10&&this._sparklerLife.cellId++,9==this._sparklerLife.cellId&&this._sparkWarningSfx.play(),10==this._sparklerLife.cellId&&(this.stopSpark=!0,clearInterval(this._handle),this._sparkWarningSfx.stop()))}),2e3),this._sparkhandle=setInterval((()=>{this.gamePaused||(this._sparklerLife.cellId<10&&this._spark.cellId<5?this._spark.cellId++:this._sparklerLife.cellId<10&&this._spark.cellId>=5?this._spark.cellId=0:(this._spark.cellId=0,clearInterval(this._sparkhandle)))}),185)}stopSparklerTimer(e){this.stopSpark=!0,null!=e&&(e.stop(),this._scene.getLightByName("sparklight").intensity=0)}_createPauseMenu(){this.gamePaused=!1;const e=new w.Rectangle;e.horizontalAlignment=w.Control.HORIZONTAL_ALIGNMENT_CENTER,e.verticalAlignment=w.Control.VERTICAL_ALIGNMENT_CENTER,e.height=.8,e.width=.5,e.thickness=0,e.isVisible=!1;const t=new w.Image("pause","sprites/pause.jpeg");e.addControl(t);const i=new w.StackPanel;i.width=.83,e.addControl(i);const n=w.Button.CreateSimpleButton("resume","RESUME");n.width=.18,n.height="44px",n.color="white",n.fontFamily="Viga",n.paddingBottom="14px",n.cornerRadius=14,n.fontSize="12px",n.textBlock.resizeToFit=!0,n.horizontalAlignment=w.Control.HORIZONTAL_ALIGNMENT_LEFT,n.verticalAlignment=w.Control.VERTICAL_ALIGNMENT_CENTER,i.addControl(n),this._pauseMenu=e,n.onPointerDownObservable.add((()=>{this._pauseMenu.isVisible=!1,this._playerUI.removeControl(e),this.pauseBtn.isHitTestVisible=!0,this.gamePaused=!1,this._startTime=(new Date).getTime(),this._scene.getSoundByName("gameSong").play(),this._pause.stop(),this._sparkWarningSfx.isPaused&&this._sparkWarningSfx.play(),this._sfx.play()}));const s=w.Button.CreateSimpleButton("controls","CONTROLS");s.width=.18,s.height="44px",s.color="white",s.fontFamily="Viga",s.paddingBottom="14px",s.cornerRadius=14,s.fontSize="12px",n.textBlock.resizeToFit=!0,s.verticalAlignment=w.Control.VERTICAL_ALIGNMENT_CENTER,s.horizontalAlignment=w.Control.HORIZONTAL_ALIGNMENT_LEFT,i.addControl(s),s.onPointerDownObservable.add((()=>{this._controls.isVisible=!0,this._pauseMenu.isVisible=!1,this._sfx.play()}));const o=w.Button.CreateSimpleButton("quit","QUIT");o.width=.18,o.height="44px",o.color="white",o.fontFamily="Viga",o.paddingBottom="12px",o.cornerRadius=14,o.fontSize="12px",n.textBlock.resizeToFit=!0,o.horizontalAlignment=w.Control.HORIZONTAL_ALIGNMENT_LEFT,o.verticalAlignment=w.Control.VERTICAL_ALIGNMENT_CENTER,i.addControl(o),m.Effect.RegisterShader("fade","precision highp float;varying vec2 vUV;uniform sampler2D textureSampler; uniform float fadeLevel; void main(void){vec4 baseColor = texture2D(textureSampler, vUV) * fadeLevel;baseColor.a = 1.0;gl_FragColor = baseColor;}"),this.fadeLevel=1,o.onPointerDownObservable.add((()=>{const e=new m.PostProcess("Fade","fade",["fadeLevel"],null,1,this._scene.getCameraByName("cam"));e.onApply=e=>{e.setFloat("fadeLevel",this.fadeLevel)},this.transition=!0,this.quitSfx.play(),this._pause.isPlaying&&this._pause.stop()}))}_createControlsMenu(){const e=new w.Rectangle;e.horizontalAlignment=w.Control.HORIZONTAL_ALIGNMENT_CENTER,e.verticalAlignment=w.Control.VERTICAL_ALIGNMENT_CENTER,e.height=.8,e.width=.5,e.thickness=0,e.color="white",e.isVisible=!1,this._playerUI.addControl(e),this._controls=e;const t=new w.Image("controls","sprites/controls.jpeg");e.addControl(t);const i=new w.TextBlock("title","CONTROLS");i.resizeToFit=!0,i.verticalAlignment=w.Control.VERTICAL_ALIGNMENT_TOP,i.fontFamily="Viga",i.fontSize="32px",i.top="14px",e.addControl(i);const n=w.Button.CreateImageOnlyButton("back","./sprites/lanternbutton.jpeg");n.width="40px",n.height="40px",n.top="14px",n.thickness=0,n.horizontalAlignment=w.Control.HORIZONTAL_ALIGNMENT_RIGHT,n.verticalAlignment=w.Control.VERTICAL_ALIGNMENT_TOP,e.addControl(n),n.onPointerDownObservable.add((()=>{this._pauseMenu.isVisible=!0,this._controls.isVisible=!1,this._sfx.play()}))}_loadSounds(e){this._pause=new m.Sound("pauseSong","./sounds/Snowland.wav",e,(function(){}),{volume:.2}),this._sfx=new m.Sound("selection","./sounds/vgmenuselect.wav",e,(function(){})),this.quitSfx=new m.Sound("quit","./sounds/Retro Event UI 13.wav",e,(function(){})),this._sparkWarningSfx=new m.Sound("sparkWarning","./sounds/Retro Water Drop 01.wav",e,(function(){}),{loop:!0,volume:.5,playbackRate:.6})}}class f{_scene;mesh;isLit=!1;_lightmtl;_light;_spinAnim;_stars;constructor(e,t,i,n,s){this._scene=i,this._lightmtl=e,this._loadLantern(t,n),this._loadStars(),this._spinAnim=s;const o=new m.PointLight("lantern light",this.mesh.getAbsolutePosition(),this._scene);o.intensity=0,o.radius=2,o.diffuse=new m.Color3(.45,.56,.8),this._light=o,this._findNearestMeshes(o)}_loadLantern(e,t){this.mesh=e,this.mesh.scaling=new m.Vector3(.8,.8,.8),this.mesh.setAbsolutePosition(t),this.mesh.isPickable=!1}setEmissiveTexture(){this.isLit=!0,this._spinAnim.play(),this._stars.start(),this.mesh.material=this._lightmtl,this._light.intensity=30}_findNearestMeshes(e){this.mesh.name.includes("14")||this.mesh.name.includes("15")?e.includedOnlyMeshes.push(this._scene.getMeshByName("festivalPlatform1")):this.mesh.name.includes("16")||this.mesh.name.includes("17")?e.includedOnlyMeshes.push(this._scene.getMeshByName("festivalPlatform2")):this.mesh.name.includes("18")||this.mesh.name.includes("19")?e.includedOnlyMeshes.push(this._scene.getMeshByName("festivalPlatform3")):(this.mesh.name.includes("20")||this.mesh.name.includes("21"))&&e.includedOnlyMeshes.push(this._scene.getMeshByName("festivalPlatform4")),this._scene.getTransformNodeByName(this.mesh.name+"lights").getChildMeshes().forEach((t=>{e.includedOnlyMeshes.push(t)}))}_loadStars(){const e=new m.ParticleSystem("stars",1e3,this._scene);e.particleTexture=new m.Texture("textures/solidStar.png",this._scene),e.emitter=new m.Vector3(this.mesh.position.x,this.mesh.position.y+1.5,this.mesh.position.z),e.createPointEmitter(new m.Vector3(.6,1,0),new m.Vector3(0,1,0)),e.color1=new m.Color4(1,1,1),e.color2=new m.Color4(1,1,1),e.colorDead=new m.Color4(1,1,1,1),e.emitRate=12,e.minEmitPower=14,e.maxEmitPower=14,e.addStartSizeGradient(0,2),e.addStartSizeGradient(1,.8),e.minAngularSpeed=0,e.maxAngularSpeed=2,e.addDragGradient(0,.7,.7),e.targetStopDuration=.25,this._stars=e}}class C{_scene;_lanternObjs;_lightmtl;_fireworkObjs=[];_startFireworks=!1;constructor(e){this._scene=e,this._lanternObjs=[];const t=new m.PBRMetallicRoughnessMaterial("lantern mesh light",this._scene);t.emissiveTexture=new m.Texture("/textures/litLantern.png",this._scene,!0,!1),t.emissiveColor=new m.Color3(.8784313725490196,.7568627450980392,.6235294117647059),this._lightmtl=t}async load(){const e=await this._loadAsset();e.allMeshes.forEach((e=>{e.receiveShadows=!0,e.checkCollisions=!0,"ground"==e.name&&(e.checkCollisions=!1,e.isPickable=!1),(e.name.includes("stairs")||"cityentranceground"==e.name||"fishingground.001"==e.name||e.name.includes("lilyflwr"))&&(e.checkCollisions=!1,e.isPickable=!1),e.name.includes("collision")&&(e.isVisible=!1,e.isPickable=!0),e.name.includes("Trigger")&&(e.isVisible=!1,e.isPickable=!1,e.checkCollisions=!1)})),e.lantern.isVisible=!1;const t=new m.TransformNode("lanternHolder",this._scene);for(let i=0;i<22;i++){let n=e.lantern.clone("lantern"+i);n.isVisible=!0,n.setParent(t);let s=new m.AnimationGroup("lanternAnimGroup "+i);s.addTargetedAnimation(e.animationGroups.targetedAnimations[0].animation,n);let o=new f(this._lightmtl,n,this._scene,e.env.getChildTransformNodes(!1).find((e=>e.name==="lantern "+i)).getAbsolutePosition(),s);this._lanternObjs.push(o)}e.lantern.dispose(),e.animationGroups.dispose();for(let i=0;i<20;i++)this._fireworkObjs.push(new y(this._scene,i));this._scene.onBeforeRenderObservable.add((()=>{this._fireworkObjs.forEach((e=>{this._startFireworks&&e._startFirework()}))}))}async _loadAsset(){const e=await m.SceneLoader.ImportMeshAsync(null,"./models/","envSetting.glb",this._scene);let t=e.meshes[0],i=t.getChildMeshes();const n=await m.SceneLoader.ImportMeshAsync("","./models/","lantern.glb",this._scene);let s=n.meshes[0].getChildren()[0];s.parent=null,n.meshes[0].dispose();const o=n.animationGroups;let a=[];a.push(o[0].targetedAnimations[0].animation),o[0].dispose();let r=new m.AnimationGroup("lanternAnimGroup");return r.addTargetedAnimation(a[0],n.meshes[1]),{env:t,allMeshes:i,lantern:s,animationGroups:r}}checkLanterns(e){this._lanternObjs[0].isLit||this._lanternObjs[0].setEmissiveTexture(),this._lanternObjs.forEach((t=>{e.mesh.actionManager.registerAction(new m.ExecuteCodeAction({trigger:m.ActionManager.OnIntersectionEnterTrigger,parameter:t.mesh},(()=>{!t.isLit&&e.sparkLit?(e.lanternsLit+=1,t.setEmissiveTexture(),e.sparkReset=!0,e.sparkLit=!0,e.lightSfx.play()):t.isLit&&(e.sparkReset=!0,e.sparkLit=!0,e.sparkResetSfx.play())})))}))}}class y{_scene;_emitter;_rocket;_exploded=!1;_height;_delay;_started;_explosionSfx;_rocketSfx;constructor(e,t){this._scene=e;const i=m.Mesh.CreateSphere("rocket",4,1,e);i.isVisible=!1;let n=10*Math.random();i.position=new m.Vector3(e.getTransformNodeByName("fireworks").getAbsolutePosition().x+-1*n,e.getTransformNodeByName("fireworks").getAbsolutePosition().y,e.getTransformNodeByName("fireworks").getAbsolutePosition().z),this._emitter=i;let s=new m.ParticleSystem("rocket",350,e);s.particleTexture=new m.Texture("./textures/flare.png",e),s.emitter=i,s.emitRate=20,s.minEmitBox=new m.Vector3(0,0,0),s.maxEmitBox=new m.Vector3(0,0,0),s.color1=new m.Color4(.49,.57,.76),s.color2=new m.Color4(.29,.29,.66),s.colorDead=new m.Color4(0,0,.2,.5),s.minSize=1,s.maxSize=1,s.addSizeGradient(0,1),s.addSizeGradient(1,.01),this._rocket=s,this._height=i.position.y+19*Math.random()+4,this._delay=60*(Math.random()*t+1),this._loadSounds()}_explosions(e){const t=m.Mesh.CreateSphere("explosion",4,1,this._scene);t.isVisible=!1,t.position=e;let i=t;i.useVertexColors=!0;let n=i.getVerticesData(m.VertexBuffer.PositionKind),s=i.getVerticesData(m.VertexBuffer.NormalKind),o=[];for(let a=0;a<n.length;a+=3){let e=new m.Vector3(n[a],n[a+1],n[a+2]),t=new m.Vector3(s[a],s[a+1],s[a+2]),r=Math.random(),l=Math.random(),h=Math.random(),c=1,d=new m.Color4(r,l,h,c);o.push(r),o.push(l),o.push(h),o.push(c);let p=m.Mesh.CreateBox("gizmo",.001,this._scene);p.position=e,p.parent=i;let u=t.normalize().scale(1);const _=new m.ParticleSystem("particles",500,this._scene);_.particleTexture=new m.Texture("textures/flare.png",this._scene),_.emitter=p,_.minEmitBox=new m.Vector3(1,0,0),_.maxEmitBox=new m.Vector3(1,0,0),_.minSize=.1,_.maxSize=.1,_.color1=d,_.color2=d,_.colorDead=new m.Color4(0,0,0,0),_.minLifeTime=1,_.maxLifeTime=2,_.emitRate=500,_.gravity=new m.Vector3(0,-9.8,0),_.direction1=u,_.direction2=u,_.minEmitPower=10,_.maxEmitPower=13,_.updateSpeed=.01,_.targetStopDuration=.2,_.disposeOnStop=!0,_.start()}i.setVerticesData(m.VertexBuffer.ColorKind,o)}_startFirework(){this._started?this._emitter.position.y>=this._height&&!this._exploded?(this._explosionSfx.play(),this._exploded=!this._exploded,this._explosions(this._emitter.position),this._emitter.dispose(),this._rocket.stop()):this._emitter.position.y+=.2:this._delay<=0?(this._started=!0,this._rocketSfx.play(),this._rocket.start()):this._delay--}_loadSounds(){this._rocketSfx=new m.Sound("selection","./sounds/fw_05.wav",this._scene,(function(){}),{volume:.5}),this._explosionSfx=new m.Sound("selection","./sounds/fw_03.wav",this._scene,(function(){}),{volume:.5})}}(function(e){e[e["START"]=0]="START",e[e["GAME"]=1]="GAME",e[e["LOSE"]=2]="LOSE",e[e["CUTSCENE"]=3]="CUTSCENE"})(g||(g={}));class v{_scene;_canvas;_engine;assets;_input;_player;_ui;_environment;game;end;_state=0;_gamescene;_cutScene;_transition=!1;constructor(e){this._canvas=this._createCanvas(e),this._init()}async _init(){this._engine=await m.EngineFactory.CreateAsync(this._canvas,void 0),this._scene=new m.Scene(this._engine),window.addEventListener("keydown",(e=>{e.shiftKey&&e.ctrlKey&&e.altKey&&73===e.keyCode&&(this._scene.debugLayer.isVisible()?this._scene.debugLayer.hide():this._scene.debugLayer.show())})),await this._main()}async _main(){await this._goToStart(),this._engine.runRenderLoop((()=>{switch(this._state){case g.START:this._scene.render();break;case g.CUTSCENE:this._scene.render();break;case g.GAME:this._ui.time>=240&&!this._player.win&&(this._goToLose(),this._ui.stopTimer()),this._ui.quit&&(this._goToStart(),this._ui.quit=!1),this._scene.render();break;case g.LOSE:this._scene.render();break;default:break}})),window.addEventListener("resize",(()=>{this._engine.resize()}))}_createCanvas(e){return document.documentElement.style["overflow"]="hidden",document.documentElement.style.overflow="hidden",document.documentElement.style.width="100%",document.documentElement.style.height="100%",document.documentElement.style.margin="0",document.documentElement.style.padding="0",document.body.style.overflow="hidden",document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0",document.body.style.padding="0",e.style.width="100%",e.style.height="100%",e.height=window.innerHeight,e.width=window.innerWidth,e.id="gameCanvas",this._canvas=e,e}async _goToStart(){this._engine.displayLoadingUI(),this._scene.detachControl();let e=new m.Scene(this._engine);e.clearColor=new m.Color4(0,0,0,1);let t=new m.FreeCamera("camera1",new m.Vector3(0,0,0),e);t.setTarget(m.Vector3.Zero());new m.Sound("startSong","./sounds/copycat(revised).mp3",e,(function(){}),{volume:.25,loop:!0,autoplay:!0});const i=new m.Sound("selection","./sounds/vgmenuselect.wav",e,(function(){})),n=w.AdvancedDynamicTexture.CreateFullscreenUI("UI");n.idealHeight=720;const s=new w.Rectangle("titleContainer");s.width=.8,s.thickness=0,n.addControl(s);const o=new w.Image("startbg","sprites/start.jpeg");s.addControl(o);const a=new w.TextBlock("title","SUMMER'S FESTIVAL");a.resizeToFit=!0,a.fontFamily="Ceviche One",a.fontSize="64px",a.color="white",a.resizeToFit=!0,a.top="14px",a.width=.8,a.verticalAlignment=w.Control.VERTICAL_ALIGNMENT_TOP,s.addControl(a);const r=w.Button.CreateSimpleButton("start","PLAY");r.fontFamily="Viga",r.width=.2,r.height="40px",r.color="white",r.top="-14px",r.thickness=0,r.verticalAlignment=w.Control.VERTICAL_ALIGNMENT_BOTTOM,s.addControl(r),m.Effect.RegisterShader("fade","precision highp float;varying vec2 vUV;uniform sampler2D textureSampler; uniform float fadeLevel; void main(void){vec4 baseColor = texture2D(textureSampler, vUV) * fadeLevel;baseColor.a = 1.0;gl_FragColor = baseColor;}");let l=1;this._transition=!1,e.registerBeforeRender((()=>{this._transition&&(l-=.05,l<=0&&(this._goToCutScene(),this._transition=!1))})),r.onPointerDownObservable.add((()=>{const n=new m.PostProcess("Fade","fade",["fadeLevel"],null,1,t);n.onApply=e=>{e.setFloat("fadeLevel",l)},this._transition=!0,i.play(),e.detachControl()}));let h=!1;if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){h=!0;const e=new w.Rectangle;e.height=.2,e.width=.3,e.verticalAlignment=w.Control.HORIZONTAL_ALIGNMENT_CENTER,e.horizontalAlignment=w.Control.VERTICAL_ALIGNMENT_CENTER,e.background="white",e.alpha=.8,n.addControl(e);const t=new w.Rectangle;t.height=.2,t.width=.3,t.verticalAlignment=w.Control.HORIZONTAL_ALIGNMENT_CENTER,t.horizontalAlignment=w.Control.VERTICAL_ALIGNMENT_CENTER,t.color="whites",n.addControl(t);const i=new w.StackPanel;i.verticalAlignment=w.Control.VERTICAL_ALIGNMENT_BOTTOM,t.addControl(i);const s=new w.Image("rotate","./sprites/rotate.png");s.width=.4,s.height=.6,s.verticalAlignment=w.Control.VERTICAL_ALIGNMENT_TOP,t.addControl(s);const o=new w.TextBlock("alert","For the best experience, please rotate your device");o.fontSize="16px",o.fontFamily="Viga",o.color="black",o.resizeToFit=!0,o.textWrapping=!0,i.addControl(o);const a=w.Button.CreateSimpleButton("close","X");a.height="24px",a.width="24px",a.color="black",i.addControl(a),r.isHitTestVisible=!1,a.onPointerUpObservable.add((()=>{n.removeControl(t),n.removeControl(e),r.isHitTestVisible=!0,this._engine.enterFullscreen(!0)}))}await e.whenReadyAsync(),this._engine.hideLoadingUI(),this._scene.dispose(),this._scene=e,this._state=g.START}async _goToCutScene(){this._engine.displayLoadingUI(),this._scene.detachControl(),this._cutScene=new m.Scene(this._engine);let e=new m.FreeCamera("camera1",new m.Vector3(0,0,0),this._cutScene);e.setTarget(m.Vector3.Zero()),this._cutScene.clearColor=new m.Color4(0,0,0,1);const t=w.AdvancedDynamicTexture.CreateFullscreenUI("cutscene");let i=0,n=!1,s=!1,o=0;const a=new w.Image("sparkLife","./sprites/beginning_anim.png");a.stretch=w.Image.STRETCH_UNIFORM,a.cellId=0,a.cellHeight=480,a.cellWidth=480,a.sourceWidth=480,a.sourceHeight=480,t.addControl(a),a.onImageLoadedObservable.add((()=>{o++}));const r=new w.Image("sparkLife","./sprites/working_anim.png");r.stretch=w.Image.STRETCH_UNIFORM,r.cellId=0,r.cellHeight=480,r.cellWidth=480,r.sourceWidth=480,r.sourceHeight=480,r.isVisible=!1,t.addControl(r),r.onImageLoadedObservable.add((()=>{o++}));const l=new w.Image("sparkLife","./sprites/dropoff_anim.png");l.stretch=w.Image.STRETCH_UNIFORM,l.cellId=0,l.cellHeight=480,l.cellWidth=480,l.sourceWidth=480,l.sourceHeight=480,l.isVisible=!1,t.addControl(l),l.onImageLoadedObservable.add((()=>{o++}));const h=new w.Image("sparkLife","./sprites/leaving_anim.png");h.stretch=w.Image.STRETCH_UNIFORM,h.cellId=0,h.cellHeight=480,h.cellWidth=480,h.sourceWidth=480,h.sourceHeight=480,h.isVisible=!1,t.addControl(h),h.onImageLoadedObservable.add((()=>{o++}));const c=new w.Image("sparkLife","./sprites/watermelon_anim.png");c.stretch=w.Image.STRETCH_UNIFORM,c.cellId=0,c.cellHeight=480,c.cellWidth=480,c.sourceWidth=480,c.sourceHeight=480,c.isVisible=!1,t.addControl(c),c.onImageLoadedObservable.add((()=>{o++}));const d=new w.Image("sparkLife","./sprites/reading_anim.png");d.stretch=w.Image.STRETCH_UNIFORM,d.cellId=0,d.cellHeight=480,d.cellWidth=480,d.sourceWidth=480,d.sourceHeight=480,d.isVisible=!1,t.addControl(d),d.onImageLoadedObservable.add((()=>{o++}));const p=new w.Image("sparkLife","./sprites/bg_anim_text_dialogue.png");p.stretch=w.Image.STRETCH_UNIFORM,p.cellId=0,p.cellHeight=480,p.cellWidth=480,p.sourceWidth=480,p.sourceHeight=480,p.horizontalAlignment=0,p.verticalAlignment=0,p.isVisible=!1,t.addControl(p),p.onImageLoadedObservable.add((()=>{o++}));const u=new w.Image("sparkLife","./sprites/text_dialogue.png");u.stretch=w.Image.STRETCH_UNIFORM,u.cellId=0,u.cellHeight=480,u.cellWidth=480,u.sourceWidth=480,u.sourceHeight=480,u.horizontalAlignment=0,u.verticalAlignment=0,u.isVisible=!1,t.addControl(u),u.onImageLoadedObservable.add((()=>{o++}));let _=setInterval((()=>{s&&p.cellId<3?p.cellId++:p.cellId=0}),250);const T=w.Button.CreateSimpleButton("skip","SKIP");let f,C;T.fontFamily="Viga",T.width="45px",T.left="-14px",T.height="40px",T.color="white",T.top="14px",T.thickness=0,T.verticalAlignment=w.Control.VERTICAL_ALIGNMENT_TOP,T.horizontalAlignment=w.Control.HORIZONTAL_ALIGNMENT_RIGHT,t.addControl(T),T.onPointerDownObservable.add((()=>{this._cutScene.detachControl(),clearInterval(f),clearInterval(C),clearInterval(_),this._engine.displayLoadingUI(),n=!0}));let y=1;this._cutScene.onBeforeRenderObservable.add((()=>{8==o&&(this._engine.hideLoadingUI(),o=0,f=setInterval((()=>{switch(y){case 1:9==a.cellId?(y++,a.isVisible=!1,r.isVisible=!0):a.cellId++;break;case 2:11==r.cellId?(y++,r.isVisible=!1,l.isVisible=!0):r.cellId++;break;case 3:11==l.cellId?(y++,l.isVisible=!1,h.isVisible=!0):l.cellId++;break;case 4:9==h.cellId?(y++,h.isVisible=!1,c.isVisible=!0):h.cellId++;break;default:break}}),250),C=setInterval((()=>{switch(y){case 5:8==c.cellId?(y++,c.isVisible=!1,d.isVisible=!0):c.cellId++;break;case 6:11==d.cellId?(d.isVisible=!1,s=!0,p.isVisible=!0,u.isVisible=!0,v.isVisible=!0):d.cellId++;break}}),750)),x&&n&&(n=!1,this._goToGame())}));const v=w.Button.CreateImageOnlyButton("next","./sprites/arrowBtn.png");v.rotation=Math.PI/2,v.thickness=0,v.verticalAlignment=w.Control.VERTICAL_ALIGNMENT_BOTTOM,v.horizontalAlignment=w.Control.HORIZONTAL_ALIGNMENT_RIGHT,v.width="64px",v.height="64px",v.top="-3%",v.left="-12%",v.isVisible=!1,t.addControl(v),v.onPointerUpObservable.add((()=>{8==i?(this._cutScene.detachControl(),this._engine.displayLoadingUI(),i=0,n=!0):i<8&&(i++,u.cellId++)})),await this._cutScene.whenReadyAsync(),this._scene.dispose(),this._state=g.CUTSCENE,this._scene=this._cutScene;var x=!1;await this._setUpGame().then((e=>{x=!0}))}async _setUpGame(){let e=new m.Scene(this._engine);this._gamescene=e,this._loadSounds(e);const t=new C(e);this._environment=t,await this._environment.load(),await this._loadCharacterAssets(e)}_loadSounds(e){this.game=new m.Sound("gameSong","./sounds/Christmassynths.wav",e,(function(){}),{loop:!0,volume:.1}),this.end=new m.Sound("endSong","./sounds/copycat(revised).mp3",e,(function(){}),{volume:.25})}async _goToGame(){this._scene.detachControl();let e=this._gamescene;const t=new T(e);this._ui=t,e.detachControl();const i=m.CubeTexture.CreateFromPrefilteredData("textures/envtext.env",e);i.name="env",i.gammaSpace=!1,e.environmentTexture=i,e.environmentIntensity=.04,this._input=new u(e,this._ui),await this._initializeGameAsync(e),await e.whenReadyAsync(),e.getMeshByName("outer").position=e.getTransformNodeByName("startPosition").getAbsolutePosition(),this._ui.startTimer(),this._ui.startSparklerTimer(this._player.sparkler),this._scene.dispose(),this._state=g.GAME,this._scene=e,this._engine.hideLoadingUI(),this._scene.attachControl(),this.game.play()}_showWin(){this.game.dispose(),this.end.play(),this._player.onRun.clear();const e=w.AdvancedDynamicTexture.CreateFullscreenUI("UI");e.idealHeight=720;const t=new w.Rectangle;t.thickness=0,t.background="black",t.alpha=.4,t.width=.4,e.addControl(t);const i=new w.StackPanel("credits");i.width=.4,i.fontFamily="Viga",i.fontSize="16px",i.color="white",e.addControl(i);const n=new w.TextBlock("special");n.resizeToFit=!0,n.color="white",n.text="Special thanks to the Babylon Team!",n.textWrapping=!0,n.height="24px",n.width="100%",n.fontFamily="Viga",i.addControl(n);const s=new w.TextBlock("music","Music");s.fontSize=22,s.resizeToFit=!0,s.textWrapping=!0;const o=new w.TextBlock("sources","Sources: freesound.org, opengameart.org, and itch.io");o.textWrapping=!0,o.resizeToFit=!0;const a=new w.TextBlock("jumpCred","jump2 by LloydEvans09 - freesound.org");a.textWrapping=!0,a.resizeToFit=!0;const r=new w.TextBlock("walkCred","Concrete 2 by MayaSama @mayasama.itch.io / ig: @mayaragandra");r.textWrapping=!0,r.resizeToFit=!0;const l=new w.TextBlock("gameSong","Christmas synths by 3xBlast - opengameart.org");l.textWrapping=!0,l.resizeToFit=!0;const h=new w.TextBlock("pauseSong","Music by Matthew Pablo / www.matthewpablo.com - opengameart.org");h.textWrapping=!0,h.resizeToFit=!0;const c=new w.TextBlock("startendSong","copycat by syncopika - opengameart.org");c.textWrapping=!0,c.resizeToFit=!0;const d=new w.TextBlock("loseSong","Eye of the Storm by Joth - opengameart.org");d.textWrapping=!0,d.resizeToFit=!0;const p=new w.TextBlock("fireworks","rubberduck - opengameart.org");p.textWrapping=!0,p.resizeToFit=!0;const m=new w.TextBlock("dashCred","Woosh Noise 1 by potentjello - freesound.org");m.textWrapping=!0,m.resizeToFit=!0;const u=new w.TextBlock("sfxCred","200 Free SFX - https://kronbits.itch.io/freesfx");u.textWrapping=!0,u.resizeToFit=!0;const _=new w.TextBlock("sfxCred2","sound pack by wobbleboxx.com - opengameart.org");_.textWrapping=!0,_.resizeToFit=!0;const g=new w.TextBlock("select","8bit menu select by Fupi - opengameart.org");g.textWrapping=!0,g.resizeToFit=!0,i.addControl(s),i.addControl(o),i.addControl(a),i.addControl(r),i.addControl(l),i.addControl(h),i.addControl(c),i.addControl(d),i.addControl(p),i.addControl(m),i.addControl(u),i.addControl(_),i.addControl(g);const T=w.Button.CreateSimpleButton("mainmenu","RETURN");T.verticalAlignment=w.Control.VERTICAL_ALIGNMENT_BOTTOM,T.fontFamily="Viga",T.width=.2,T.height="40px",T.color="white",e.addControl(T),T.onPointerDownObservable.add((()=>{this._ui.transition=!0,this._ui.quitSfx.play()}))}async _goToLose(){this._engine.displayLoadingUI(),this._scene.detachControl();let e=new m.Scene(this._engine);e.clearColor=new m.Color4(0,0,0,1);let t=new m.FreeCamera("camera1",new m.Vector3(0,0,0),e);t.setTarget(m.Vector3.Zero());new m.Sound("loseSong","./sounds/Eye of the Storm.mp3",e,(function(){}),{volume:.25,loop:!0,autoplay:!0});const i=new m.Sound("selection","./sounds/vgmenuselect.wav",e,(function(){})),n=w.AdvancedDynamicTexture.CreateFullscreenUI("UI");n.idealHeight=720;const s=new w.Image("lose","sprites/lose.jpeg");s.autoScale=!0,n.addControl(s);const o=new w.StackPanel;n.addControl(o);const a=new w.TextBlock;a.fontSize=24,a.color="white",a.height="100px",a.width="100%",o.addControl(a),a.textHorizontalAlignment=w.TextBlock.HORIZONTAL_ALIGNMENT_CENTER,a.textVerticalAlignment=w.TextBlock.VERTICAL_ALIGNMENT_CENTER,a.text="There's no fireworks this year";const r=new w.TextBlock;r.color="white",r.fontSize=24,r.height="100px",r.width="100%",r.text="....";const l=w.Button.CreateSimpleButton("mainmenu","MAIN MENU");l.width=.2,l.height="40px",l.color="white",o.addControl(l),m.Effect.RegisterShader("fade","precision highp float;varying vec2 vUV;uniform sampler2D textureSampler; uniform float fadeLevel; void main(void){vec4 baseColor = texture2D(textureSampler, vUV) * fadeLevel;baseColor.a = 1.0;gl_FragColor = baseColor;}");let h=1;this._transition=!1,e.registerBeforeRender((()=>{this._transition&&(h-=.05,h<=0&&(this._goToStart(),this._transition=!1))})),l.onPointerUpObservable.add((()=>{e.detachControl(),n.dispose(),this._transition=!0,i.play()})),await e.whenReadyAsync(),this._engine.hideLoadingUI(),this._scene.dispose(),this._scene=e,this._state=g.LOSE}async _loadCharacterAssets(e){async function t(){const t=m.MeshBuilder.CreateBox("outer",{width:2,depth:1,height:3},e);return t.isVisible=!1,t.isPickable=!1,t.checkCollisions=!0,t.bakeTransformIntoVertices(m.Matrix.Translation(0,1.5,0)),t.ellipsoid=new m.Vector3(1,1.5,1),t.ellipsoidOffset=new m.Vector3(0,1.5,0),t.rotationQuaternion=new m.Quaternion(0,1,0,0),m.SceneLoader.ImportMeshAsync(null,"./models/","player.glb",e).then((e=>{const i=e.meshes[0],n=i;return n.parent=t,n.isPickable=!1,n.getChildMeshes().forEach((e=>{e.isPickable=!1})),{mesh:t,animationGroups:e.animationGroups}}))}return t().then((e=>{this.assets=e}))}async _initializeGameAsync(e){e.ambientColor=new m.Color3(.34509803921568627,.5568627450980392,.8352941176470589),e.clearColor=new m.Color4(.01568627450980392,.01568627450980392,.20392156862745098);const t=new m.PointLight("sparklight",new m.Vector3(0,0,0),e);t.diffuse=new m.Color3(.08627450980392157,.10980392156862745,.15294117647058825),t.intensity=35,t.radius=1;const i=new m.ShadowGenerator(1024,t);i.darkness=.4,this._player=new _(this.assets,e,i,this._input);this._player.activatePlayerCamera();this._environment.checkLanterns(this._player),e.registerBeforeRender((()=>{this._ui.transition&&(this._ui.fadeLevel-=.05,this._ui.fadeLevel<=0&&(this._ui.quit=!0,this._ui.transition=!1))})),e.onBeforeRenderObservable.add((()=>{if(this._player.sparkReset?(this._ui.startSparklerTimer(this._player.sparkler),this._player.sparkReset=!1,this._ui.updateLanternCount(this._player.lanternsLit)):this._ui.stopSpark&&this._player.sparkLit&&(this._ui.stopSparklerTimer(this._player.sparkler),this._player.sparkLit=!1),this._player.win&&22==this._player.lanternsLit){this._ui.gamePaused=!0,this._ui.pauseBtn.isHitTestVisible=!1;let e=10;window.setInterval((()=>{e--,0==e&&this._showWin()}),1e3),this._environment._startFireworks=!0,this._player.win=!1}this._ui.gamePaused||this._ui.updateHud(),this._player.tutorial_move&&this._player.tutorial_jump&&this._player.tutorial_dash&&(this._ui.tutorial.isVisible||this._ui.hint.isVisible)&&(this._ui.tutorial.isVisible=!1,this._environment._lanternObjs[1].isLit?this._ui.hint.isVisible=!1:this._ui.hint.isVisible=!0)}));const n=new m.GlowLayer("glow",e);n.intensity=.4,this._environment._lanternObjs.forEach((e=>{n.addIncludedOnlyMesh(e.mesh)}))}}let x;const A={created(){x=this},mounted:()=>{const e=(x||{$refs:{canvas:null}}).$refs.canvas;new v(e)}},b=(0,a.Z)(A,[["render",p]]),I=b,S={ref:"canvas"};function k(e,t,i,n,o,a){return(0,s.wg)(),(0,s.iD)("canvas",S,null,512)}const L=class{canvas;scene;engine;constructor(e){this.canvas=e,this.engine=this.createEngine(this.canvas),this.scene=this.createScene(),this.engine.runRenderLoop((()=>{this.scene.render()}))}createEngine(e){return new m.Engine(e,!0)}createScene(){const e=new m.Scene(this.engine),t=new m.FreeCamera("camera",new m.Vector3(0,1,-5),e);t.attachControl(),t.speed=.1;const i=new m.HemisphericLight("hemi-light",new m.Vector3(0,1,0),e);i.intensity=1;const n=m.MeshBuilder.CreateGround("ground",{width:10,height:10},e),s=m.MeshBuilder.CreateSphere("sphere",{diameter:1});return s.position=new m.Vector3(0,1,0),s.material=this.createBallMaterial(),n.material=this.createGroundMaterial(),e}createGroundMaterial(){const e=new m.StandardMaterial("ground-material",this.scene),t=4,i=[],n=new m.Texture("./textures/stone/diffuse.jpg",this.scene);e.diffuseTexture=n,i.push(n);const s=new m.Texture("./textures/stone/normal.jpg",this.scene);e.bumpTexture=s,e.invertNormalMapX=!0,e.invertNormalMapY=!0,i.push(s);const o=new m.Texture("./textures/stone/ao.jpg",this.scene);e.ambientTexture=o,i.push(o);const a=new m.Texture("./textures/stone/spec.jpg",this.scene);return e.specularTexture=a,i.push(a),i.forEach((e=>{e.uScale=t,e.vScale=t})),e}createBallMaterial(){const e=new m.StandardMaterial("ball-material",this.scene),t=1,i=[],n=new m.Texture("./textures/metal/diffuse.jpg",this.scene);e.diffuseTexture=n,i.push(n);const s=new m.Texture("./textures/metal/normal.jpg",this.scene);e.bumpTexture=s,e.invertNormalMapX=!0,e.invertNormalMapY=!0,i.push(s);const o=new m.Texture("./textures/metal/ao.jpg",this.scene);e.ambientTexture=o,i.push(o);const a=new m.Texture("./textures/metal/spec.jpg",this.scene);return e.specularTexture=a,i.push(a),i.forEach((e=>{e.uScale=t,e.vScale=t})),e.specularPower=1,e}};function R(e,t){t&&(e.height=t.height,e.width=t.width);new L(e)}let E;const M={created(){E=this},mounted:()=>{const e=(E||{$refs:{canvas:null}}).$refs.canvas;R(e,{height:window.innerHeight,width:window.innerWidth}),console.log("@ Learning Page :)")}},N=(0,a.Z)(M,[["render",k]]),O=N,V=(0,c.p7)({history:(0,c.r5)(),routes:[{path:"/",redirect:"/learning"},{path:"/learning",component:O},{path:"/game",component:I}]}),B=(0,n.ri)(h);B.use(V),B.mount("#app")}},t={};function i(n){var s=t[n];if(void 0!==s)return s.exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,i),o.exports}i.m=e,(()=>{var e=[];i.O=(t,n,s,o)=>{if(!n){var a=1/0;for(c=0;c<e.length;c++){for(var[n,s,o]=e[c],r=!0,l=0;l<n.length;l++)(!1&o||a>=o)&&Object.keys(i.O).every((e=>i.O[e](n[l])))?n.splice(l--,1):(r=!1,o<a&&(a=o));if(r){e.splice(c--,1);var h=s();void 0!==h&&(t=h)}}return t}o=o||0;for(var c=e.length;c>0&&e[c-1][2]>o;c--)e[c]=e[c-1];e[c]=[n,s,o]}})(),(()=>{i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}})(),(()=>{i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})(),(()=>{i.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}})(),(()=>{var e={143:0};i.O.j=t=>0===e[t];var t=(t,n)=>{var s,o,[a,r,l]=n,h=0;if(a.some((t=>0!==e[t]))){for(s in r)i.o(r,s)&&(i.m[s]=r[s]);if(l)var c=l(i)}for(t&&t(n);h<a.length;h++)o=a[h],i.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return i.O(c)},n=self["webpackChunkbabylon_101"]=self["webpackChunkbabylon_101"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var n=i.O(void 0,[998],(()=>i(5505)));n=i.O(n)})();
//# sourceMappingURL=app.11c9a14e.js.map